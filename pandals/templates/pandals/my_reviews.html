<!DOCTYPE html>
<html>
<head>
<title>My Reviews</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
background:#0b0f14;
color:white;
font-family:Poppins;
padding:20px;
}

.card{
background:linear-gradient(135deg,#0f172a,#020617);
padding:18px;
border-radius:16px;
margin-bottom:15px;
box-shadow:0 0 20px rgba(0,255,255,.12);
}

.btn{
padding:6px 14px;
border-radius:20px;
border:none;
font-weight:600;
cursor:pointer;
}

.edit{background:#00ffff;color:black;}
.delete{background:#ff4d4d;color:white;}

/* ===== COMMON ===== */
        body{
          margin:0;
          font-family:Arial, sans-serif;
          background:#0e1218;
          color:white;
        }

        button{
          min-height:38px;
          font-size:14px;
          border-radius:10px;
        }

        input,select,textarea{
          border-radius:10px;
          padding:8px;
          font-size:14px;
        }

        #map{
          width:100%;
          height:100vh;
        }

        .topbar{
          display:flex;
          justify-content:space-between;
          align-items:center;
          padding:10px;
          background:#0b0f14;
          box-shadow:0 0 10px rgba(0,255,255,.3);
        }

        .title{font-size:16px;font-weight:700;}

        .user-avatar{
          width:34px;height:34px;border-radius:50%;
          background:#00ff99;display:flex;
          align-items:center;justify-content:center;
          color:black;font-weight:bold;
        }

        #searchBox{width:260px;}

        .route-info{
          background:#0b0f14;
          padding:12px;border-radius:14px;
          box-shadow:0 0 10px rgba(0,255,255,.3);
          font-size:14px;
        }

        .leaflet-popup-content{
          max-height:250px;
          overflow-y:auto;
        }

        @media(max-width:768px){
          .topbar{flex-wrap:wrap;text-align:center;gap:6px;}
          .title{width:100%;font-size:14px;}
          .top-actions{width:100%;display:flex;justify-content:center;gap:10px;}
          #searchBox{width:85% !important;top:70px;}
          .route-info{font-size:13px;max-width:90%;}
          button{width:100%;}
        }

        @media(min-width:769px){
          .topbar{padding:12px 30px;}
          .title{font-size:18px;}
          .route-info{font-size:15px;}
          #searchBox{width:300px;}
        }
</style>
</head>

<body>
    
<a href="{% url 'dashboard' %}" style="
text-decoration:none;
color:#00ffff;
border:1px solid #00ffff;
padding:6px 16px;
border-radius:20px;
font-weight:600;
display:inline-block;
margin-bottom:15px;
">
⬅ Back to Dashboard
</a>

<h2>⭐ My Reviews</h2>

{% if reviews %}
{% for r in reviews %}
<div class="card">

<h3>{{ r.pandal.name }}</h3>
<p>Rating ⭐ {{ r.rating }}</p>
<p>{{ r.comment }}</p>

<button class="btn edit"
data-id="{{ r.id }}"
data-comment="{{ r.comment|escapejs }}"
data-rating="{{ r.rating }}"
onclick="openEdit(this)">
Edit
</button>



<a href="{% url 'delete_review' r.id %}">
<button class="btn delete">Delete</button>
</a>

</div>
{% endfor %}
{% else %}
<p>No reviews yet</p>
{% endif %}

<!-- EDIT MODAL -->
<div id="editBox" style="
display:none;
position:fixed;
top:50%;
left:50%;
transform:translate(-50%,-50%);
background:#0e1218;
padding:20px;
border-radius:16px;
box-shadow:0 0 25px rgba(0,255,255,.4);
z-index:9999;
">

<h3>Edit Review</h3>

<select id="editRating">
<option value="5">⭐5</option>
<option value="4">⭐4</option>
<option value="3">⭐3</option>
<option value="2">⭐2</option>
<option value="1">⭐1</option>
</select><br><br>

<textarea id="editComment" rows="3"></textarea><br><br>

<button class="btn edit" onclick="saveEdit()">Save</button>
<button class="btn delete" onclick="closeEdit()">Cancel</button>

</div>

<script>
let editId=null;

function openEdit(btn){
    editId = btn.dataset.id;
    document.getElementById("editComment").value = btn.dataset.comment;
    document.getElementById("editRating").value = btn.dataset.rating;
    document.getElementById("editBox").style.display = "block";
}


function closeEdit(){
    document.getElementById("editBox").style.display="none";
}

function saveEdit(){
    fetch(`/edit-review/${editId}/`, {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": getCookie("csrftoken")
        },
        body: JSON.stringify({
            rating: document.getElementById("editRating").value,
            comment: document.getElementById("editComment").value
        })
    })
    .then(res => res.json())
    .then(data => {
        location.reload();
    });
}

function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
</script>

</body>
</html>

